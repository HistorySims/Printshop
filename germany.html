<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Press & Profit ‚Äî Germany (1517)</title>

  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --ui-ink: rgba(20, 18, 16, 0.92);
      --ui-paper: rgba(245, 236, 220, 0.92);
      --ui-paper2: rgba(245, 236, 220, 0.82);
      --ui-shadow: rgba(0,0,0,0.45);
      --ui-glow: rgba(255,255,255,0.20);

      --btn-bg: rgba(10,10,12,0.75);
      --btn-br: rgba(255,255,255,0.28);

      --spine-bg: rgba(245, 240, 232, 0.92);
      --spine-ink: rgba(30, 25, 20, 0.95);
      --spine-br: rgba(0,0,0,0.35);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      height:100vh;
      overflow:hidden;
      font-family: Georgia, serif;
      background:#000;
    }

    /* Backdrop stage */
    .stage{
      position:relative;
      width:100%;
      height:100%;
      background: url("IMG_4315.png") center / cover no-repeat;
    }

    /* slight vignette to help readability without ‚ÄúUI panels‚Äù */
    .vignette{
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 700px at 30% 20%, rgba(0,0,0,0.12), rgba(0,0,0,0.45)),
        linear-gradient(180deg, rgba(0,0,0,0.20), rgba(0,0,0,0.38));
      pointer-events:none;
    }

    /* Top bar (minimal, translucent) */
    .topbar{
      position:absolute;
      left:0; right:0; top:0;
      z-index:5;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px;
      color:#fff;
      font-size:14px;
      background: rgba(0,0,0,0.45);
      backdrop-filter: blur(3px);
    }
    .topbar .group{
      display:flex;
      align-items:center;
      gap:8px;
      min-width: 130px;
    }
    .topbar .center{
      flex:1;
      text-align:center;
      opacity:0.95;
      font-weight:bold;
      letter-spacing:0.3px;
    }
    button{
      font-family: Georgia, serif;
      padding:7px 10px;
      background: var(--btn-bg);
      color:#fff;
      border:1px solid var(--btn-br);
      border-radius:10px;
      cursor:pointer;
    }
    button:hover{ border-color: rgba(255,255,255,0.40); }

    /* ---------- HITBOX LAYOUT (place UI over painted objects) ---------- */

    /* ADJUST HERE: fine-tune these if your backdrop crops differently on some screens */
    .hit-order-scroll{   /* big scroll area (current order) */
      position:absolute;
      left: 7%;
      top: 17%;
      width: 52%;
      height: 22%;
      z-index:3;
      pointer-events:none; /* display only */
    }

    .hit-type-area{      /* type composing area (bottom-left desk) */
      position:absolute;
      left: 7%;
      top: 50%;
      width: 56%;
      height: 40%;
      z-index:3;
    }

    .hit-shelves{        /* right shelf column area */
      position:absolute;
      left: 69%;
      top: 18%;
      width: 27%;
      height: 76%;
      z-index:3;
      display:flex;
      flex-direction:column;
      gap: 3.8%;
      padding: 2% 3%;
    }

    /* Each shelf bay sits on top of the art‚Äôs shelf compartments */
    .shelf-bay{
      flex:1;
      position:relative;
      border-radius:10px;
      /* NO big panel ‚Äî just subtle ‚Äúedge read‚Äù */
      background: rgba(0,0,0,0.06);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.10),
        inset 0 -14px 18px rgba(0,0,0,0.18);
      overflow:hidden;
    }

    .shelf-label{
      position:absolute;
      left:8px;
      top:7px;
      font-size:10px;
      color: rgba(255,255,255,0.75);
      text-shadow: 0 2px 6px rgba(0,0,0,0.55);
      pointer-events:none;
    }

    /* Inventory ‚Äúspines‚Äù */
    .spines{
      position:absolute;
      left:6px; right:6px;
      bottom:6px;
      top:22px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:6px;
      align-content:end;
      padding-bottom:2px;
    }

    .spine{
      height: 26px;
      border-radius:6px;
      background: var(--spine-bg);
      border:1px solid var(--spine-br);
      box-shadow:
        0 6px 10px rgba(0,0,0,0.22),
        inset 0 1px 0 rgba(255,255,255,0.55);
      color: var(--spine-ink);
      font-size:8px;
      line-height:1.1;
      padding:3px 5px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      cursor:pointer;
      user-select:none;
    }
    .spine .t{
      font-weight:bold;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }
    .spine .x{
      align-self:flex-end;
      font-size:10px;
      opacity:0.75;
    }

    /* Type composing visuals (kept ‚Äúpaper/wood‚Äù not modern UI) */
    .type-card{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:12px;
      border-radius:14px;
      background: rgba(245,236,220,0.80);
      box-shadow: 0 18px 40px rgba(0,0,0,0.35);
      border: 1px solid rgba(0,0,0,0.25);
      backdrop-filter: blur(1px);
    }
    .type-title{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
    }
    .type-title b{ color:#000; }
    .type-title .sub{
      font-size:12px;
      color: rgba(0,0,0,0.72);
    }

    .bed, .tray{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      padding:10px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.28);
      background: rgba(255,255,255,0.85);
      min-height:60px;
      align-items:center;
    }

    .block{
      width:44px;
      height:44px;
      border-radius:10px;
      background: rgba(93,64,55,0.92);
      border:1px solid rgba(0,0,0,0.35);
      box-shadow:
        0 10px 18px rgba(0,0,0,0.25),
        inset 0 1px 0 rgba(255,255,255,0.18);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:bold;
      font-size:18px;
      cursor:pointer;
      user-select:none;
    }

    /* ‚ÄúCurrent order‚Äù scroll overlay */
    .scroll-card{
      width:100%;
      height:100%;
      border-radius:16px;
      background: rgba(245,236,220,0.72);
      border: 1px solid rgba(0,0,0,0.20);
      box-shadow: 0 16px 36px rgba(0,0,0,0.30);
      padding:12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:6px;
    }
    .scroll-card .h{
      font-weight:bold;
      color:#000;
      font-size:14px;
    }
    .scroll-card .p{
      font-size:13px;
      color: rgba(0,0,0,0.72);
    }
    .scroll-card .pat{
      font-size:14px;
      letter-spacing:1px;
      font-weight:bold;
      color:#000;
    }

    /* Orders overlay */
    .overlay{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,0.72);
      z-index:20;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:12px;
    }
    .modal{
      width: min(560px, 96vw);
      max-height: 86vh;
      overflow:auto;
      background: rgba(245,236,220,0.96);
      border: 3px double rgba(0,0,0,0.85);
      box-shadow: 0 22px 60px rgba(0,0,0,0.55);
      padding:14px;
      border-radius:14px;
      color:#000;
    }
    .modal h3{
      margin:0 0 10px;
      font-size:16px;
    }
    .job{
      border: 1px solid rgba(0,0,0,0.35);
      background: rgba(255,255,255,0.75);
      border-radius:12px;
      padding:10px;
      margin-bottom:10px;
      cursor:pointer;
    }
    .job:hover{ background: rgba(255,255,255,0.92); }
    .job small{ color: rgba(0,0,0,0.70); }

    /* Mobile: stack shelves under type area if needed */
    @media (max-width: 820px){
      .hit-shelves{
        left: 6%;
        top: 92%;
        width: 88%;
        height: 6%;
        display:none; /* on small screens shelves in art won‚Äôt line up reliably */
      }
      .hit-type-area{
        left: 5%;
        width: 90%;
      }
      .hit-order-scroll{
        left: 5%;
        width: 90%;
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    // ---------------------------
    // Minimal job set (expand later)
    // ---------------------------
    const JOBS = [
      { id: 1, name:"The 95 Theses", pattern:["T","H","E","S"], sellRate:0.08 },
      { id: 2, name:"Indulgence Form", pattern:["I","N","D","L"], sellRate:0.03 },
      { id: 3, name:"Satirical Woodcut", pattern:["H","A","H","A"], sellRate:0.05 },
      { id: 4, name:"Ballad Sheet", pattern:["L","I","E","D"], sellRate:0.02 },
      { id: 5, name:"Donatus (Latin Grammar)", pattern:["D","O","N","A"], sellRate:0.01 },
    ];
    const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2);

    // ---------------------------
    // App
    // ---------------------------
    function App(){
      const SHELF_CAPACITY = 20;

      const [wallet, setWallet] = React.useState(0);
      const [ordersOpen, setOrdersOpen] = React.useState(false);

      const [job, setJob] = React.useState(null);
      const [tray, setTray] = React.useState([]);
      const [bed, setBed] = React.useState([]);

      // single inventory list; we‚Äôll ‚Äúdisplay‚Äù it across 4 bays visually
      const [stock, setStock] = React.useState([]);

      // ---------------------------
      // SALES LOOP (slow + steady)
      // ---------------------------
      React.useEffect(()=>{
        const t = setInterval(()=>{
          setStock(prev=>{
            if(prev.length === 0) return prev;
            const next = [...prev];
            for(let i=next.length-1;i>=0;i--){
              if(Math.random() < next[i].sellRate){
                setWallet(w => w + 1); // hidden payout (keep simple here)
                next.splice(i, 1);
              }
            }
            return next;
          });
        }, 450);
        return ()=>clearInterval(t);
      },[]);

      // ---------------------------
      // Helpers
      // ---------------------------
      function shuffle(arr){
        const a = [...arr];
        for(let i=a.length-1;i>0;i--){
          const j = Math.floor(Math.random()*(i+1));
          [a[i],a[j]]=[a[j],a[i]];
        }
        return a;
      }

      function acceptJob(j){
        setJob(j);
        setTray(shuffle(j.pattern));
        setBed([]);
        setOrdersOpen(false);
      }

      function clickBlock(ch){
        if(!job) return;

        const nextBed = [...bed, ch];
        setBed(nextBed);

        // remove one instance from tray
        const idx = tray.indexOf(ch);
        const nextTray = [...tray];
        if(idx >= 0) nextTray.splice(idx, 1);
        setTray(nextTray);

        if(nextBed.length === 4){
          const ok = nextBed.every((c,i)=>c === job.pattern[i]);

          if(ok){
            setStock(prev=>{
              if(prev.length >= SHELF_CAPACITY) return prev; // full
              return [...prev, { ...job, uid: uid() }];
            });
          }

          // reset composition either way
          setBed([]);
          setTray(shuffle(job.pattern));
        }
      }

      function trash(uidToRemove){
        setStock(prev => prev.filter(x => x.uid !== uidToRemove));
      }

      // split stock across 4 bays for display only
      const bays = React.useMemo(()=>{
        const perBay = Math.ceil(SHELF_CAPACITY / 4); // 5 if cap 20
        const out = [[],[],[],[]];
        for(let i=0;i<stock.length;i++){
          out[Math.floor(i / perBay)].push(stock[i]);
        }
        return out;
      }, [stock]);

      return (
        <div className="stage">
          <div className="vignette"></div>

          <div className="topbar">
            <div className="group">
              <button onClick={()=>window.location.href="index.html"}>Exit</button>
              <button onClick={()=>setOrdersOpen(true)}>Orders</button>
            </div>

            <div className="center">Germany (1517)</div>

            <div className="group" style={{justifyContent:"flex-end"}}>
              <div style={{fontWeight:"bold"}}>üí∞ {wallet}</div>
            </div>
          </div>

          {/* Current order scroll (display only) */}
          <div className="hit-order-scroll">
            <div className="scroll-card">
              <div className="h">Today‚Äôs order</div>
              <div className="p">{job ? job.name : "Open Orders to choose a job."}</div>
              <div className="p">Set pattern:</div>
              <div className="pat">{job ? job.pattern.join("") : "‚Äî"}</div>
              <div className="p" style={{fontSize:12, opacity:0.8}}>
                Shelf capacity: {stock.length}/20
              </div>
            </div>
          </div>

          {/* Type composing area */}
          <div className="hit-type-area">
            <div className="type-card">
              <div className="type-title">
                <div>
                  <b>Composing</b>
                  <div className="sub">{job ? job.name : "Choose an order first"}</div>
                </div>
                <div className="sub">{job ? "Click blocks to set type" : ""}</div>
              </div>

              <div>
                <div style={{fontSize:12, marginBottom:6, color:"rgba(0,0,0,0.75)"}}>Print bed</div>
                <div className="bed">
                  {bed.length === 0 && <div style={{opacity:0.65, fontSize:12}}>Place 4 blocks‚Ä¶</div>}
                  {bed.map((c,i)=>(
                    <div key={i} className="block" style={{cursor:"default"}}>{c}</div>
                  ))}
                </div>
              </div>

              <div>
                <div style={{fontSize:12, marginBottom:6, color:"rgba(0,0,0,0.75)"}}>Type tray</div>
                <div className="tray">
                  {tray.length === 0 && <div style={{opacity:0.65, fontSize:12}}>‚Äî</div>}
                  {tray.map((c,i)=>(
                    <div key={i} className="block" onClick={()=>clickBlock(c)}>{c}</div>
                  ))}
                </div>
              </div>

              <div style={{fontSize:12, color:"rgba(0,0,0,0.70)"}}>
                When you set the type correctly, <b>one copy</b> goes onto the shelf.
                (Next step: we‚Äôll add print-run quantity.)
              </div>
            </div>
          </div>

          {/* Shelves overlay ‚Äî aligned to the painted shelves */}
          <div className="hit-shelves">
            {["Top shelf","Shelf 2","Shelf 3","Bottom shelf"].map((label, i)=>(
              <div className="shelf-bay" key={i}>
                <div className="shelf-label">{label}</div>
                <div className="spines">
                  {bays[i].map(item=>(
                    <div key={item.uid} className="spine" onClick={()=>trash(item.uid)} title="Click to trash">
                      <div className="t">{item.name}</div>
                      <div className="x">√ó</div>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>

          {/* Orders overlay */}
          {ordersOpen && (
            <div className="overlay" onClick={()=>setOrdersOpen(false)}>
              <div className="modal" onClick={(e)=>e.stopPropagation()}>
                <h3>Incoming Orders</h3>
                <div style={{fontSize:12, color:"rgba(0,0,0,0.72)", marginBottom:10}}>
                  Click an order to accept. You won‚Äôt be told what sells best ‚Äî watch what clears off the shelves.
                </div>
                {JOBS.map(j=>(
                  <div className="job" key={j.id} onClick={()=>acceptJob(j)}>
                    <div style={{fontWeight:"bold"}}>{j.name}</div>
                    <small>Pattern: {j.pattern.join("")}</small>
                  </div>
                ))}
                <div style={{display:"flex", gap:10, marginTop:8}}>
                  <button onClick={()=>setOrdersOpen(false)} style={{background:"rgba(0,0,0,0.75)"}}>Close</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App/>, document.getElementById("root"));
  </script>
</body>
</html>
