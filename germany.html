<!doctype html>
<html lang="ens le="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Press & Profit â€” Germany (1517)</title>

  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --ink:#1b1b1f;
      --paper:#efe7d8;
      --panel:rgba(255,255,255,0.85);
      --overlay:rgba(0,0,0,0.75);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Georgia, serif;
      background:#000;
      height:100vh;
      overflow:hidden;
    }

    /* BACKDROP */
    .stage{
      position:relative;
      width:100%;
      height:100%;
      background:url("IMG_4315.png") center / cover no-repeat;
      display:flex;
      flex-direction:column;
    }
    .shade{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.35);
      pointer-events:none;
    }

    /* TOP BAR */
    .topbar{
      position:relative;
      z-index:2;
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px;
      background:rgba(0,0,0,0.55);
      color:#fff;
      font-size:14px;
    }
    .topbar button{
      background:#000;
      color:#fff;
      border:1px solid #fff;
      padding:6px 10px;
      cursor:pointer;
      font-family:Georgia, serif;
    }

    /* WORK AREA */
    .work{
      position:relative;
      z-index:2;
      flex:1;
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:12px;
      padding:12px;
    }

    /* TYPE AREA */
    .type-area{
      background:var(--panel);
      border:2px solid var(--ink);
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .bed, .tray{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      padding:8px;
      background:#fff;
      border:1px solid var(--ink);
      min-height:56px;
    }
    .block{
      width:42px;
      height:42px;
      background:#5d4037;
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      cursor:pointer;
      user-select:none;
    }

    /* SHELVES */
    .shelves{
      background:rgba(0,0,0,0.65);
      color:#fff;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .shelf{
      border:1px solid #fff;
      padding:6px;
      min-height:120px;
      font-size:12px;
    }

    /* OVERLAY */
    .overlay{
      position:absolute;
      inset:0;
      background:var(--overlay);
      display:flex;
      justify-content:center;
      align-items:center;
      z-index:10;
    }
    .modal{
      background:var(--paper);
      color:#000;
      width:90%;
      max-width:520px;
      padding:16px;
      border:3px double #000;
    }
    .job{
      border:1px solid #000;
      padding:8px;
      margin-bottom:8px;
      cursor:pointer;
    }
    .job:hover{
      background:#f5f0e5;
    }
  </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">

/* ---------------- DATA ---------------- */

const JOBS = [
  { id:1, name:"Ninety-Five Theses", pattern:["T","H","E","S"], rate:0.08 },
  { id:2, name:"Indulgence Handbill", pattern:["I","N","D","L"], rate:0.03 },
  { id:3, name:"Satirical Woodcut", pattern:["H","A","H","A"], rate:0.05 }
];

const uid = () => Math.random().toString(36).slice(2);

/* ---------------- APP ---------------- */

function App(){
  const [wallet, setWallet] = React.useState(0);
  const [ordersOpen, setOrdersOpen] = React.useState(false);
  const [job, setJob] = React.useState(null);

  const [tray, setTray] = React.useState([]);
  const [bed, setBed] = React.useState([]);

  const [shelf, setShelf] = React.useState([]);

  /* SALES LOOP */
  React.useEffect(()=>{
    const t = setInterval(()=>{
      setShelf(prev=>{
        const next = [...prev];
        for(let i=next.length-1;i>=0;i--){
          if(Math.random() < next[i].rate){
            setWallet(w=>w+1);
            next.splice(i,1);
          }
        }
        return next;
      });
    }, 400);
    return ()=>clearInterval(t);
  },[]);

  function acceptJob(j){
    setJob(j);
    setTray([...j.pattern].sort(()=>Math.random()-0.5));
    setBed([]);
    setOrdersOpen(false);
  }

  function clickBlock(ch){
    if(!job) return;
    const next = [...bed, ch];
    setBed(next);
    setTray(tray.filter((c,i)=> i!==tray.indexOf(ch)));

    if(next.length===4){
      const ok = next.every((c,i)=>c===job.pattern[i]);
      if(ok){
        if(shelf.length<20){
          setShelf(s=>[...s,{...job, uid:uid()}]);
        }
      }
      setBed([]);
      setTray([...job.pattern].sort(()=>Math.random()-0.5));
    }
  }

  return (
    <div className="stage">
      <div className="shade"></div>

      <div className="topbar">
        <button onClick={()=>window.location.href="index.html"}>Exit</button>
        <div>Germany (1517)</div>
        <div>ðŸ’° {wallet}</div>
        <button onClick={()=>setOrdersOpen(true)}>Orders</button>
      </div>

      <div className="work">
        <div className="type-area">
          <div><b>Composing</b> {job ? job.name : "â€”"}</div>
          <div className="bed">
            {bed.map((c,i)=><div key={i} className="block">{c}</div>)}
          </div>
          <div className="tray">
            {tray.map((c,i)=>
              <div key={i} className="block" onClick={()=>clickBlock(c)}>{c}</div>
            )}
          </div>
        </div>

        <div className="shelves">
          <div><b>Sales Shelf</b> ({shelf.length}/20)</div>
          <div className="shelf">
            {shelf.map(s=><div key={s.uid}>{s.name}</div>)}
          </div>
        </div>
      </div>

      {ordersOpen && (
        <div className="overlay" onClick={()=>setOrdersOpen(false)}>
          <div className="modal" onClick={e=>e.stopPropagation()}>
            <h3>Available Orders</h3>
            {JOBS.map(j=>(
              <div key={j.id} className="job" onClick={()=>acceptJob(j)}>
                <b>{j.name}</b><br/>
                Pattern: {j.pattern.join("")}
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<App/>, document.getElementById("root"));

</script>
</body>
</html>
